<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="my-code/flow-style.css" rel="stylesheet">

    <script src="other-author-lib/RaumZeit/Marchingsquares.js"></script>

    <script src="my-code/fade.js"></script>
    <link href="./my-code/global-design.css" rel="stylesheet">
    <link href="./my-code/ui-anim.css" rel="stylesheet">
    <!--辞書のサイズが小さいものを選択-->
</head>
<body>
 
        
    <svg style="position:absolute;" width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">
        <defs>
            <mask id="fade-anim-mask"
            maskUnits="objectBoundingBox"
            x="0%"
            y="0%"
            width="100%"
            height="100%">
                <g transform="scale(1.45, 1.45) translate(-5, -60)">
                    <rect id="fade-mask-bg" fill="white" x="0%" y="0%" width="100%" height="500%"></rect>
                    <path id="fade-mask-target" d="" fill="black" fill-rule="evenodd"/>
                    <filter>
                      <feGaussianBlur stdDeviation="5"/>
                    </filter>
                </g>
            </mask>
        </defs>
    </svg>
    <header class="rotated-ui">
      <span class="item"><a href="/works.html">Works<span class="hitobj"></span></a></span>
      <span class="item"><a href="/contact.html">Contact<span class="hitobj"></span></a></span>
      <span class="item"><a href="#top">Top<span class="hitobj"></span></a></span>
      <span class="item"><a href="/news.html">News<span class="hitobj"></span></a></span>
      <span class="vr">w<br>h<br>o</span>
      <span class="vr">a<br>r<br>e</span>
      <span class="vr">y<br>o<br>u</span>
    </header>
    <main class="container-base">
        <div class="board">
          <div class="board-content" id="main-container">
            <div class="section" id="top">
              <div class="margin-for-background a1"></div>
              <h1><span class="unit">WORKS</span><span class="unit"></span></h1>
              <h4>This is dummy content<br>
              <!--<br>s1f102400606@iniad.org</h4>-->
              <div class="margin-for-background a2"></div>
            </div>
            <div class="frame-1 section">
              Game Developping
            </div>
            <form id="searchbox-form">
               <input placeholder="言語モデルで検索" id="searchbox">
            </form>
            <hr>
            <!--<form id="visitor-form">
                属性から自動選択
                <br>
                <select id="attribute1">
                  <option value="a">ゲームを見たい</option>
                  <option value="b">音楽を見たい</option>
                  <option value="b">絵をみたい</option>
                  <option value="b">プログラムをみたい</option>
                </select>
                <br>
                <select id="attribute2">
                  <option value="a">実用性</option>
                  <option value="b">雰囲気</option>
                </select>
            </form>-->

            <div id="works-container">
                <div id="flow-container">
                    <span>検索ワードを入れるとこのセクションは自動生成されます。</span>
                    <!--class="container-base flow-list-container"-->
                    <!--<img src="./a8ei.png">-->
                </div>
                <div id="flow-container-scroll-marker"></div>
            </div>

<!--          <canvas id="myCanvas"></canvas>-->

          <div id="myCanvas"></div>

        </div>
        <div class="triangle-menu-container p5-choikekkougomimenyubutton triangle thin-item" id="smartphone-overlay-button">
          <a><div class="menu-item"><section class="reversed-text">品物</section></div></a>
        </div>
        <div class="smartphone-overlay-menu-content" id="smartphone-overlay-menu">
          <a href="works.html">WORKS</a><br>
          <a href="contact.html">CONTACT</a><br>
          <a href="news.html">NEWS</a><br>
          <a href="#top">TOP</a><br>
        </div>
    </main>
    <footer style="background:yellow;color:rgb(60,60,60);">Copyright &copy; 2026 旻.</footer>
    <div id="full-screen-main-multi-ui-container"></div>
    
    <!--<script src="other-author-lib/p5js/perlinnoise.js"></script>-->
    
    <script src="./my-code/define.js"></script>
    <script src="./my-code/ui.js"></script>
    <script src="my-code/flow.js"></script>
    <script type="module">
        document.getElementById("flow-container-scroll-marker").scrollIntoView({
            behavior: 'smooth',
            block: 'center'
        });

        import { pipeline } from "https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.1/dist/transformers.min.js";

        const pipe = await pipeline('feature-extraction', 'Xenova/all-MiniLM-L6-v2');

        //const segmenter = new TinySegmenter();
        const searchBoxForm = document.getElementById("searchbox-form");
        const searchBox = document.getElementById("searchbox");
        

        /*もしかしたら今後AIの登場でスペース区切りの検索に慣れてない人も出てくるかもなので分かち書きに変換したうえで分割する*/
        
        const candidate = await Promise.all([
            ["海と人の暗い雰囲気の絵",         
                new Item(
                    {
                       "label": "絵",
                       "image": "my-works/content/ko.png",
                       "stack": ["アクリル画", "デジタル絵", "(レタリング)"],
                       "description": "飛行機",
                       "detailed": "ダミーコンテンツ",
                    }
                ),
            ],
            ["キャラクター CG 3Dモデル 写真", 
                new Item(
                    {
                       "label": "絵",
                       "image": "my-works/content/ko.png",
                       "stack": ["アクリル画", "デジタル絵", "(レタリング)"],
                       "description": "飛行機",
                       "detailed": "ダミーコンテンツ",
                    }
                ),
            ],
            ["SPAM 防止 チャットボット BOT ツール プログラム",
                new Item(
                    {
                        "label": "SPAM防止BOT",
                        "video": "my-works/content/chatbot.mp4",
                        "stack": ["NodeJS", "DiscordJS"],
                        "description": 
                        "スパム防止機能：\n"+
                        "単語数と文字数の比に言語ごとに特徴がある気がしたので、その値などを使ってにスパムかどうかを判定する機能を作りました。",
                        "detailed": "ダミーコンテンツ",
                    }
                )
            ],
            ["ウェブアプリケーション",
                new Item(
                    {
                        "label": "ウェブアプリケーション",
                        "video": "my-works/content/memolive-app.mp4",
                        "stack": ["JS", "TS", "SCSS", "HTML", "React"],
                        "description": "いろいろなボックスを自由に並べたり入れ子状に組み合わせてデザインできる共同編集可能なノートアプリケーション",
                        "detailed": "ダミーコンテンツ",
                    }
                )
            ],
            ["コーネルボックス CG 大域照明モデル リムナルスペース",
                new Item(
                    {
                        "label": "pyOpenGL",
                        "movie": "",
                        "stack": ["CG", "pyOpenGL"],
                        "description": "-- -- --",
                        "detailed": "ダミーコンテンツ",
                    }
                )
            ]
        ].map(async(v)=>[(await pipe(v[0], {pooling: 'mean', normalize: true})).data, ...v.slice(1)]));
    
        searchBoxForm.addEventListener('submit', (e)=>{
            e.preventDefault();
            (async()=>{
                const output = await pipe(searchBox.value, { pooling: 'mean', normalize: true });
                console.log(output.data);
                //const splitted = searchBox.value.split(/\s/).reduce((res,v)=>[...segmenter.segment(v), ...res],[]);
                let target = candidate.map(c=>[getCosineWithouNormalize(c[0],output.data), ...c.slice(1)])
                target.sort((a,b)=>b[0] - a[0]);
                //console.log(target, target.map(t=>t[1]));
                const flow = new Items(null, ...target.map(t=>t[1]));
                flow.display(document.getElementById("flow-container"));
                document.getElementById("flow-container-scroll-marker").scrollIntoView({
                    behavior: 'smooth',
                    block: 'center'
                });
            })();
        });

        function getCosineWithouNormalize(a, b) {
            //console.log(a.reduce((res,v,i)=>res + v*b[i],0))
            return a.reduce((res,v,i)=>res + v*b[i],0);
        }

        function getCosine(a, b) {
            return a.reduce((res,v,i)=>res + v*b[i],0)/(
                a.reduce((res,v)=>res+v**2,0)**0.5 * b.reduce((res,v)=>res+v**2,0)**0.5
            );
        }
    </script>
</body>
</html>